<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Color Background Remover</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f7fa;
    }
    h1 {
      color: #2d3748;
      text-align: center;
      margin-bottom: 30px;
    }
    .container {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .upload-section {
      text-align: center;
      padding: 30px;
      border: 2px dashed #cbd5e0;
      border-radius: 8px;
      margin-bottom: 20px;
      cursor: pointer;
      transition: border-color 0.3s;
    }
    .upload-section:hover {
      border-color: #4299e1;
    }
    .upload-section p {
      color: #718096;
      margin: 10px 0 0;
    }
    #fileInput {
      display: none;
    }
    .controls {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .slider-container {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .slider-container label {
      font-weight: bold;
      color: #4a5568;
    }
    .slider-container .slider-value {
      font-size: 0.9em;
      color: #718096;
    }
    .canvas-container {
      position: relative;
      margin-top: 20px;
      text-align: center;
      min-height: 300px;
      display: flex;
      justify-content: center;
    }
    canvas {
      max-width: 100%;
      border: 1px solid #e2e8f0;
      cursor: crosshair;
      background-image: 
        linear-gradient(45deg, #f0f0f0 25%, transparent 25%), 
        linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #f0f0f0 75%),
        linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    }
    button {
      background-color: #4299e1;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #3182ce;
    }
    button:disabled {
      background-color: #cbd5e0;
      cursor: not-allowed;
    }
    .img-container {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #instructions {
      margin-top: 20px;
      padding: 15px;
      background-color: #ebf8ff;
      border-left: 4px solid #4299e1;
      border-radius: 4px;
    }
    .preview-info {
      font-size: 0.9em;
      color: #718096;
      margin: 5px 0 15px;
    }
    .button-row {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }
    #color-preview {
      width: 30px;
      height: 30px;
      border: 1px solid #cbd5e0;
      border-radius: 50%;
      display: inline-block;
      vertical-align: middle;
      margin-left: 10px;
    }
    .color-info {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px 0;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h1>Color Background Remover</h1>
  <div class="container">
    <div class="upload-section" id="dropArea">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4299e1" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
      <p>Drag & drop an image or click to browse</p>
      <input type="file" id="fileInput" accept="image/jpeg, image/png">
    </div>
    
    <div class="canvas-container">
      <canvas id="imageCanvas"></canvas>
    </div>
    
    <div class="controls" id="controls" style="display: none;">
      <div class="color-info">
        <span>Selected color to remove:</span>
        <div id="color-preview"></div>
        <span id="color-value" style="margin-left: 10px;">None selected</span>
      </div>
      
      <div class="slider-container">
        <label for="toleranceSlider">Color Tolerance:</label>
        <input type="range" id="toleranceSlider" min="0" max="100" value="30">
        <span class="slider-value" id="toleranceValue">30%</span>
      </div>
      
      <div class="button-row">
        <button id="resetBtn">Reset Image</button>
        <button id="downloadBtn">Download Result</button>
      </div>
      
      <div id="instructions">
        <p><strong>How to use:</strong></p>
        <ol>
          <li>Upload an image using the area above</li>
          <li>Click on the color in the image you want to remove</li>
          <li>Adjust the tolerance slider to fine-tune how much of the similar colors get removed</li>
          <li>Download your edited image when ready</li>
        </ol>
        <p class="preview-info">Note: The checkered background indicates transparent areas of the image.</p>
      </div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const dropArea = document.getElementById('dropArea');
    const imageCanvas = document.getElementById('imageCanvas');
    const toleranceSlider = document.getElementById('toleranceSlider');
    const toleranceValue = document.getElementById('toleranceValue');
    const resetBtn = document.getElementById('resetBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const controls = document.getElementById('controls');
    const colorPreview = document.getElementById('color-preview');
    const colorValue = document.getElementById('color-value');
    
    let ctx = imageCanvas.getContext('2d');
    let originalImage = null;
    let selectedColor = null;
    
    // Event Listeners
    dropArea.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', handleFileUpload);
    toleranceSlider.addEventListener('input', updateToleranceDisplay);
    toleranceSlider.addEventListener('change', applyColorRemoval);
    resetBtn.addEventListener('click', resetImage);
    downloadBtn.addEventListener('click', downloadImage);
    imageCanvas.addEventListener('click', handleCanvasClick);
    
    // Setup drag and drop
    dropArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropArea.style.borderColor = '#4299e1';
    });
    
    dropArea.addEventListener('dragleave', () => {
      dropArea.style.borderColor = '#cbd5e0';
    });
    
    dropArea.addEventListener('drop', (e) => {
      e.preventDefault();
      dropArea.style.borderColor = '#cbd5e0';
      if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        handleFileUpload();
      }
    });
    
    // Functions
    function handleFileUpload() {
      const file = fileInput.files[0];
      if (file && (file.type === 'image/jpeg' || file.type === 'image/png')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          loadImage(e.target.result);
        };
        reader.readAsDataURL(file);
      }
    }
    
    function loadImage(src) {
      originalImage = new Image();
      originalImage.onload = function() {
        // Set canvas dimensions based on image size, keeping aspect ratio
        const maxWidth = 800;
        const maxHeight = 600;
        let width = originalImage.width;
        let height = originalImage.height;
        
        if (width > maxWidth) {
          height = (maxWidth / width) * height;
          width = maxWidth;
        }
        
        if (height > maxHeight) {
          width = (maxHeight / height) * width;
          height = maxHeight;
        }
        
        imageCanvas.width = width;
        imageCanvas.height = height;
        
        // Draw the original image
        ctx.clearRect(0, 0, width, height);
        ctx.drawImage(originalImage, 0, 0, width, height);
        
        // Show controls
        controls.style.display = 'flex';
        
        // Reset color selection
        selectedColor = null;
        colorPreview.style.backgroundColor = 'transparent';
        colorValue.textContent = 'None selected';
      };
      originalImage.src = src;
    }
    
    function handleCanvasClick(e) {
      if (!originalImage) return;
      
      const rect = imageCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      // Get pixel data at click position
      const pixelData = ctx.getImageData(x, y, 1, 1).data;
      selectedColor = {
        r: pixelData[0],
        g: pixelData[1],
        b: pixelData[2]
      };
      
      // Update color preview
      colorPreview.style.backgroundColor = `rgb(${selectedColor.r}, ${selectedColor.g}, ${selectedColor.b})`;
      colorValue.textContent = `RGB(${selectedColor.r}, ${selectedColor.g}, ${selectedColor.b})`;
      
      // Apply color removal
      applyColorRemoval();
    }
    
    function updateToleranceDisplay() {
      toleranceValue.textContent = `${toleranceSlider.value}%`;
      if (selectedColor) {
        applyColorRemoval();
      }
    }
    
    function applyColorRemoval() {
      if (!selectedColor || !originalImage) return;
      
      // Reset canvas first
      resetCanvas();
      
      // Get image data
      const imageData = ctx.getImageData(0, 0, imageCanvas.width, imageCanvas.height);
      const data = imageData.data;
      const tolerance = parseInt(toleranceSlider.value) * 2.55; // Convert percentage to 0-255 range
      
      // Process each pixel
      for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i+1];
        const b = data[i+2];
        
        // Calculate color distance (simple Euclidean distance in RGB space)
        const distance = Math.sqrt(
          Math.pow(r - selectedColor.r, 2) +
          Math.pow(g - selectedColor.g, 2) +
          Math.pow(b - selectedColor.b, 2)
        );
        
        // If color is within tolerance, make it transparent
        if (distance <= tolerance) {
          data[i+3] = 0; // Set alpha to 0 (transparent)
        }
      }
      
      // Update canvas with new image data
      ctx.putImageData(imageData, 0, 0);
    }
    
    function resetCanvas() {
      if (!originalImage) return;
      
      ctx.clearRect(0, 0, imageCanvas.width, imageCanvas.height);
      ctx.drawImage(originalImage, 0, 0, imageCanvas.width, imageCanvas.height);
    }
    
    function resetImage() {
      if (!originalImage) return;
      
      resetCanvas();
      
      // Reset color selection
      selectedColor = null;
      colorPreview.style.backgroundColor = 'transparent';
      colorValue.textContent = 'None selected';
    }
    
    function downloadImage() {
      if (!originalImage) return;
      
      // Create temporary link element
      const link = document.createElement('a');
      link.download = 'transparent-background.png';
      link.href = imageCanvas.toDataURL('image/png');
      
      // Trigger download
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
